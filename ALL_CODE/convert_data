#!/bin/bash

if [ $# -eq 1 ]; then 
	# echo "Start Converting all packets"
	tshark -r $1 -T fields -e _ws.col.Protocol -e frame.len -e frame.cap_len -e eth.type -e icmp.checksum -e icmpv6.checksum -e ipv6.addr -e ip.hdr_len -e ip.len -e tcp.hdr_len -e tcp.len -e udp.length -e udp.srcport -e udp.dstport -e udp.checksum -E header=y > ./data/result.tsv

	echo "Start make tcp file"
	tshark -r $1 -T fields -e _ws.col.Protocol -e tcp.stream -e tcp.nxtseq -e tcp.ack -e tcp.analysis.ack_rtt -e tcp.analysis.initial_rtt -e tcp.analysis.retransmission -e tcp.analysis.fast_retransmission -e tcp.connection.fin -e tcp.connection.rst -e tcp.connection.syn -e ip.dst -e tcp.dstport -e ip.src -e tcp.srcport -e frame.len -e tcp.len -e tcp.hdr_len -e ip.hdr_len -e frame.time -E header=y> ./data/tcp_result.tsv
	
	# echo "Start make udp file"
	tshark -r $1 -T fields -e _ws.col.Protocol -e udp.stream  -e ip.dst -e udp.dstport -e ip.src -e udp.srcport -e frame.len -e udp.length -e ip.hdr_len -e frame.time -e udp.checksum -E header=y> ./data/udp_result.tsv
	
	echo "Finish Converting $1"
else
	echo "USAGE: ./convert <pcap file path>"
fi
